var Ve=Object.defineProperty;var q=Object.getOwnPropertySymbols;var Je=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var H=(e,n,r)=>n in e?Ve(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,X=(e,n)=>{for(var r in n||(n={}))Je.call(n,r)&&H(e,r,n[r]);if(q)for(var r of q(n))$e.call(n,r)&&H(e,r,n[r]);return e};var T=(e,n,r)=>new Promise((t,i)=>{var s=u=>{try{o(r.next(u))}catch(c){i(c)}},a=u=>{try{o(r.throw(u))}catch(c){i(c)}},o=u=>u.done?t(u.value):Promise.resolve(u.value).then(s,a);o((r=r.apply(e,n)).next())});import{I as Be,a as Ke}from"./index.Dmkzir.js";import{w as qe,m as D,B as _,I as Y,h as x,q as He,r as Q,x as Xe,n as Ye}from"./antd-BcJUCkMQ.js";import{d as Qe,f as R,k as m,E as y,F,i as Ze,V as We,x as we}from"./vue-BMZVVpNU.js";function et(e,n){for(var r=0;r<n.length;r++){const t=n[r];if(typeof t!="string"&&!Array.isArray(t)){for(const i in t)if(i!=="default"&&!(i in e)){const s=Object.getOwnPropertyDescriptor(t,i);s&&Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:()=>t[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}let ie=!0,se=!0;function M(e,n,r){const t=e.match(n);return t&&t.length>=r&&parseInt(t[r],10)}function P(e,n,r){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.addEventListener;t.addEventListener=function(a,o){if(a!==n)return i.apply(this,arguments);const u=c=>{const p=r(c);p&&(o.handleEvent?o.handleEvent(p):o(p))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(o,u),i.apply(this,[a,u])};const s=t.removeEventListener;t.removeEventListener=function(a,o){if(a!==n||!this._eventMap||!this._eventMap[n])return s.apply(this,arguments);if(!this._eventMap[n].has(o))return s.apply(this,arguments);const u=this._eventMap[n].get(o);return this._eventMap[n].delete(o),this._eventMap[n].size===0&&delete this._eventMap[n],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[a,u])},Object.defineProperty(t,"on"+n,{get(){return this["_on"+n]},set(a){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),a&&this.addEventListener(n,this["_on"+n]=a)},enumerable:!0,configurable:!0})}function tt(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(ie=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function rt(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(se=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function oe(){if(typeof window=="object"){if(ie)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function $(e,n){se&&console.warn(e+" is deprecated, please use "+n+" instead.")}function nt(e){const n={browser:null,version:null};if(typeof e=="undefined"||!e.navigator||!e.navigator.userAgent)return n.browser="Not a browser.",n;const{navigator:r}=e;if(r.mozGetUserMedia)n.browser="firefox",n.version=M(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)n.browser="chrome",n.version=M(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))n.browser="safari",n.version=M(r.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return n.browser="Not a supported browser.",n;return n}function Z(e){return Object.prototype.toString.call(e)==="[object Object]"}function ae(e){return Z(e)?Object.keys(e).reduce(function(n,r){const t=Z(e[r]),i=t?ae(e[r]):e[r],s=t&&!Object.keys(i).length;return i===void 0||s?n:Object.assign(n,{[r]:i})},{}):e}function U(e,n,r){!n||r.has(n.id)||(r.set(n.id,n),Object.keys(n).forEach(t=>{t.endsWith("Id")?U(e,e.get(n[t]),r):t.endsWith("Ids")&&n[t].forEach(i=>{U(e,e.get(i),r)})}))}function W(e,n,r){const t=r?"outbound-rtp":"inbound-rtp",i=new Map;if(n===null)return i;const s=[];return e.forEach(a=>{a.type==="track"&&a.trackIdentifier===n.id&&s.push(a)}),s.forEach(a=>{e.forEach(o=>{o.type===t&&o.trackId===a.id&&U(e,o,i)})}),i}const w=oe;function ce(e,n){const r=e&&e.navigator;if(!r.mediaDevices)return;const t=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const u={};return Object.keys(o).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const p=typeof o[c]=="object"?o[c]:{ideal:o[c]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const f=function(l,d){return l?l+d.charAt(0).toUpperCase()+d.slice(1):d==="deviceId"?"sourceId":d};if(p.ideal!==void 0){u.optional=u.optional||[];let l={};typeof p.ideal=="number"?(l[f("min",c)]=p.ideal,u.optional.push(l),l={},l[f("max",c)]=p.ideal,u.optional.push(l)):(l[f("",c)]=p.ideal,u.optional.push(l))}p.exact!==void 0&&typeof p.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[f("",c)]=p.exact):["min","max"].forEach(l=>{p[l]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[f(l,c)]=p[l])})}),o.advanced&&(u.optional=(u.optional||[]).concat(o.advanced)),u},i=function(o,u){if(n.version>=61)return u(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const c=function(p,f,l){f in p&&!(l in p)&&(p[l]=p[f],delete p[f])};o=JSON.parse(JSON.stringify(o)),c(o.audio,"autoGainControl","googAutoGainControl"),c(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=t(o.audio)}if(o&&typeof o.video=="object"){let c=o.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const p=n.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete o.video.facingMode;let f;if(c.exact==="environment"||c.ideal==="environment"?f=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(f=["front"]),f)return r.mediaDevices.enumerateDevices().then(l=>{l=l.filter(g=>g.kind==="videoinput");let d=l.find(g=>f.some(C=>g.label.toLowerCase().includes(C)));return!d&&l.length&&f.includes("back")&&(d=l[l.length-1]),d&&(o.video.deviceId=c.exact?{exact:d.deviceId}:{ideal:d.deviceId}),o.video=t(o.video),w("chrome: "+JSON.stringify(o)),u(o)})}o.video=t(o.video)}return w("chrome: "+JSON.stringify(o)),u(o)},s=function(o){return n.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(o,u,c){i(o,p=>{r.webkitGetUserMedia(p,u,f=>{c&&c(s(f))})})};if(r.getUserMedia=a.bind(r),r.mediaDevices.getUserMedia){const o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(u){return i(u,c=>o(c).then(p=>{if(c.audio&&!p.getAudioTracks().length||c.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(s(p))))}}}function it(e,n){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&e.navigator.mediaDevices){if(typeof n!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(t){return n(t).then(i=>{const s=t.video&&t.video.width,a=t.video&&t.video.height,o=t.video&&t.video.frameRate;return t.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:o||3}},s&&(t.video.mandatory.maxWidth=s),a&&(t.video.mandatory.maxHeight=a),e.navigator.mediaDevices.getUserMedia(t)})}}}function pe(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function ue(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",i=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===i.track.id):s={track:i.track};const a=new Event("track");a.track=i.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[t.stream],this.dispatchEvent(a)}),t.stream.getTracks().forEach(i=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===i.id):s={track:i};const a=new Event("track");a.track=i,a.receiver=s,a.transceiver={receiver:s},a.streams=[t.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else P(e,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function fe(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const n=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,u){let c=i.apply(this,arguments);return c||(c=n(this,o),this._senders.push(c)),c};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const u=this._senders.indexOf(o);u!==-1&&this._senders.splice(u,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(n(this,a))})};const t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(a=>{const o=this._senders.find(u=>u.track===a);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const t=n.apply(this,[]);return t.forEach(i=>i._pc=this),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function le(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[t,i,s]=arguments;if(arguments.length>0&&typeof t=="function")return n.apply(this,arguments);if(n.length===0&&(arguments.length===0||typeof t!="function"))return n.apply(this,[]);const a=function(u){const c={};return u.result().forEach(f=>{const l={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(d=>{l[d]=f.stat(d)}),c[l.id]=l}),c},o=function(u){return new Map(Object.keys(u).map(c=>[c,u[c]]))};if(arguments.length>=2){const u=function(c){i(o(a(c)))};return n.apply(this,[u,t])}return new Promise((u,c)=>{n.apply(this,[function(p){u(o(a(p)))},c])}).then(i,s)}}function de(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s});const t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=t.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>W(a,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i}),P(e,"track",t=>(t.receiver._pc=t.srcElement,t)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>W(s,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const t=arguments[0];let i,s,a;return this.getSenders().forEach(o=>{o.track===t&&(i?a=!0:i=o)}),this.getReceivers().forEach(o=>(o.track===t&&(s?a=!0:s=o),o.track===t)),a||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function me(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,o){if(!o)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=n.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(u)===-1&&this._shimmedLocalStreams[o.id].push(u):this._shimmedLocalStreams[o.id]=[o,u],u};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(c=>{if(this.getSenders().find(f=>f.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();r.apply(this,arguments);const u=this.getSenders().filter(c=>o.indexOf(c)===-1);this._shimmedLocalStreams[a.id]=[a].concat(u)};const t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],t.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const u=this._shimmedLocalStreams[o].indexOf(a);u!==-1&&this._shimmedLocalStreams[o].splice(u,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function he(e,n){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return me(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const p=r.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(f=>this._reverseStreams[f.id])};const t=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(f=>{if(this.getSenders().find(d=>d.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const f=new e.MediaStream(p.getTracks());this._streams[p.id]=f,this._reverseStreams[f.id]=p,p=f}t.apply(this,[p])};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},e.RTCPeerConnection.prototype.addTrack=function(p,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const l=[].slice.call(arguments,1);if(l.length!==1||!l[0].getTracks().find(C=>C===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[f.id];if(g)g.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new e.MediaStream([p]);this._streams[f.id]=C,this._reverseStreams[C.id]=f,this.addStream(C)}return this.getSenders().find(C=>C.track===p)};function s(c,p){let f=p.sdp;return Object.keys(c._reverseStreams||[]).forEach(l=>{const d=c._reverseStreams[l],g=c._streams[d.id];f=f.replace(new RegExp(g.id,"g"),d.id)}),new RTCSessionDescription({type:p.type,sdp:f})}function a(c,p){let f=p.sdp;return Object.keys(c._reverseStreams||[]).forEach(l=>{const d=c._reverseStreams[l],g=c._streams[d.id];f=f.replace(new RegExp(d.id,"g"),g.id)}),new RTCSessionDescription({type:p.type,sdp:f})}["createOffer","createAnswer"].forEach(function(c){const p=e.RTCPeerConnection.prototype[c],f={[c](){const l=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[g=>{const C=s(this,g);l[0].apply(null,[C])},g=>{l[1]&&l[1].apply(null,g)},arguments[2]]):p.apply(this,arguments).then(g=>s(this,g))}};e.RTCPeerConnection.prototype[c]=f[c]});const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=a(this,arguments[0]),o.apply(this,arguments))};const u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const c=u.get.apply(this);return c.type===""?c:s(this,c)}}),e.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let l;Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(C=>p.track===C)&&(l=this._streams[d])}),l&&(l.getTracks().length===1?this.removeStream(this._reverseStreams[l.id]):l.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function N(e,n){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const t=e.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=i[r]})}function ge(e,n){P(e,"negotiationneeded",r=>{const t=r.target;if(!((n.version<72||t.getConfiguration&&t.getConfiguration().sdpSemantics==="plan-b")&&t.signalingState!=="stable"))return r})}const ee=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:ge,shimAddTrackRemoveTrack:he,shimAddTrackRemoveTrackWithNative:me,shimGetDisplayMedia:it,shimGetSendersWithDtmf:fe,shimGetStats:le,shimGetUserMedia:ce,shimMediaStream:pe,shimOnTrack:ue,shimPeerConnection:N,shimSenderReceiverGetStats:de},Symbol.toStringTag,{value:"Module"}));function Ce(e,n){const r=e&&e.navigator,t=e&&e.MediaStreamTrack;if(r.getUserMedia=function(i,s,a){$("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(s,a)},!(n.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const i=function(a,o,u){o in a&&!(u in a)&&(a[u]=a[o],delete a[o])},s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a.audio,"autoGainControl","mozAutoGainControl"),i(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},t&&t.prototype.getSettings){const a=t.prototype.getSettings;t.prototype.getSettings=function(){const o=a.apply(this,arguments);return i(o,"mozAutoGainControl","autoGainControl"),i(o,"mozNoiseSuppression","noiseSuppression"),o}}if(t&&t.prototype.applyConstraints){const a=t.prototype.applyConstraints;t.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o,"autoGainControl","mozAutoGainControl"),i(o,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[o])}}}}function st(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(t){if(!(t&&t.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return t.video===!0?t.video={mediaSource:n}:t.video.mediaSource=n,e.navigator.mediaDevices.getUserMedia(t)})}function ye(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function z(e,n){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=e.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=a[i]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,a,o]=arguments;return t.apply(this,[s||null]).then(u=>{if(n.version<53&&!a)try{u.forEach(c=>{c.type=r[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;u.forEach((p,f)=>{u.set(f,Object.assign({},p,{type:r[p.type]||p.type}))})}return u}).then(a,o)}}function ve(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Se(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const t=n.apply(this,[]);return t.forEach(i=>i._pc=this),t}),P(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Te(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){$("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&r.getTracks().includes(t.track)&&this.removeTrack(t)})})}function Re(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Pe(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const n=e.RTCPeerConnection.prototype.addTransceiver;n&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let t=arguments[1]&&arguments[1].sendEncodings;t===void 0&&(t=[]),t=[...t];const i=t.length>0;i&&t.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=n.apply(this,arguments);if(i){const{sender:a}=s,o=a.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=t,a.sendEncodings=t,this.setParametersPromises.push(a.setParameters(o).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function be(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const n=e.RTCRtpSender.prototype.getParameters;n&&(e.RTCRtpSender.prototype.getParameters=function(){const t=n.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}function _e(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function ke(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const n=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}const te=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Pe,shimCreateAnswer:ke,shimCreateOffer:_e,shimGetDisplayMedia:st,shimGetParameters:be,shimGetUserMedia:Ce,shimOnTrack:ye,shimPeerConnection:z,shimRTCDataChannel:Re,shimReceiverGetStats:Se,shimRemoveStream:Te,shimSenderGetStats:ve},Symbol.toStringTag,{value:"Module"}));function Ee(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(i=>n.call(this,i,t)),t.getVideoTracks().forEach(i=>n.call(this,i,t))},e.RTCPeerConnection.prototype.addTrack=function(t,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),n.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(r);if(t===-1)return;this._localStreams.splice(t,1);const i=r.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function De(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=t=>{t.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(s)>=0)return;t._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,t.dispatchEvent(a)})}),n.apply(t,arguments)}}}function xe(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,r=n.createOffer,t=n.createAnswer,i=n.setLocalDescription,s=n.setRemoteDescription,a=n.addIceCandidate;n.createOffer=function(c,p){const f=arguments.length>=2?arguments[2]:arguments[0],l=r.apply(this,[f]);return p?(l.then(c,p),Promise.resolve()):l},n.createAnswer=function(c,p){const f=arguments.length>=2?arguments[2]:arguments[0],l=t.apply(this,[f]);return p?(l.then(c,p),Promise.resolve()):l};let o=function(u,c,p){const f=i.apply(this,[u]);return p?(f.then(c,p),Promise.resolve()):f};n.setLocalDescription=o,o=function(u,c,p){const f=s.apply(this,[u]);return p?(f.then(c,p),Promise.resolve()):f},n.setRemoteDescription=o,o=function(u,c,p){const f=a.apply(this,[u]);return p?(f.then(c,p),Promise.resolve()):f},n.addIceCandidate=o}function Me(e){const n=e&&e.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const r=n.mediaDevices,t=r.getUserMedia.bind(r);n.mediaDevices.getUserMedia=i=>t(Oe(i))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(t,i,s){n.mediaDevices.getUserMedia(t).then(i,s)}.bind(n))}function Oe(e){return e&&e.video!==void 0?Object.assign({},e,{video:ae(e.video)}):e}function Ie(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection;e.RTCPeerConnection=function(t,i){if(t&&t.iceServers){const s=[];for(let a=0;a<t.iceServers.length;a++){let o=t.iceServers[a];o.urls===void 0&&o.url?($("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,s.push(o)):s.push(t.iceServers[a])}t.iceServers=s}return new n(t,i)},e.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return n.generateCertificate}})}function Le(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function je(e){const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(t){if(t){typeof t.offerToReceiveAudio!="undefined"&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");t.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):t.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof t.offerToReceiveVideo!="undefined"&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="video");t.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):t.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function Ae(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const re=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Ae,shimCallbacksAPI:xe,shimConstraints:Oe,shimCreateOfferLegacy:je,shimGetUserMedia:Me,shimLocalStreamsAPI:Ee,shimRTCIceServerUrls:Ie,shimRemoteStreamsAPI:De,shimTrackEventTransceiver:Le},Symbol.toStringTag,{value:"Module"}));var Fe={exports:{}};(function(e){const n={};n.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},n.localCName=n.generateIdentifier(),n.splitLines=function(r){return r.trim().split(`
`).map(t=>t.trim())},n.splitSections=function(r){return r.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},n.getDescription=function(r){const t=n.splitSections(r);return t&&t[0]},n.getMediaSections=function(r){const t=n.splitSections(r);return t.shift(),t},n.matchPrefix=function(r,t){return n.splitLines(r).filter(i=>i.indexOf(t)===0)},n.parseCandidate=function(r){let t;r.indexOf("a=candidate:")===0?t=r.substring(12).split(" "):t=r.substring(10).split(" ");const i={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let s=8;s<t.length;s+=2)switch(t[s]){case"raddr":i.relatedAddress=t[s+1];break;case"rport":i.relatedPort=parseInt(t[s+1],10);break;case"tcptype":i.tcpType=t[s+1];break;case"ufrag":i.ufrag=t[s+1],i.usernameFragment=t[s+1];break;default:i[t[s]]===void 0&&(i[t[s]]=t[s+1]);break}return i},n.writeCandidate=function(r){const t=[];t.push(r.foundation);const i=r.component;i==="rtp"?t.push(1):i==="rtcp"?t.push(2):t.push(i),t.push(r.protocol.toUpperCase()),t.push(r.priority),t.push(r.address||r.ip),t.push(r.port);const s=r.type;return t.push("typ"),t.push(s),s!=="host"&&r.relatedAddress&&r.relatedPort&&(t.push("raddr"),t.push(r.relatedAddress),t.push("rport"),t.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(t.push("tcptype"),t.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(t.push("ufrag"),t.push(r.usernameFragment||r.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(r){return r.substring(14).split(" ")},n.parseRtpMap=function(r){let t=r.substring(9).split(" ");const i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=t.length===3?parseInt(t[2],10):1,i.numChannels=i.channels,i},n.writeRtpMap=function(r){let t=r.payloadType;r.preferredPayloadType!==void 0&&(t=r.preferredPayloadType);const i=r.channels||r.numChannels||1;return"a=rtpmap:"+t+" "+r.name+"/"+r.clockRate+(i!==1?"/"+i:"")+`\r
`},n.parseExtmap=function(r){const t=r.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},n.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},n.parseFmtp=function(r){const t={};let i;const s=r.substring(r.indexOf(" ")+1).split(";");for(let a=0;a<s.length;a++)i=s[a].trim().split("="),t[i[0].trim()]=i[1];return t},n.writeFmtp=function(r){let t="",i=r.payloadType;if(r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const s=[];Object.keys(r.parameters).forEach(a=>{r.parameters[a]!==void 0?s.push(a+"="+r.parameters[a]):s.push(a)}),t+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return t},n.parseRtcpFb=function(r){const t=r.substring(r.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(r){let t="",i=r.payloadType;return r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(s=>{t+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),t},n.parseSsrcMedia=function(r){const t=r.indexOf(" "),i={ssrc:parseInt(r.substring(7,t),10)},s=r.indexOf(":",t);return s>-1?(i.attribute=r.substring(t+1,s),i.value=r.substring(s+1)):i.attribute=r.substring(t+1),i},n.parseSsrcGroup=function(r){const t=r.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(i=>parseInt(i,10))}},n.getMid=function(r){const t=n.matchPrefix(r,"a=mid:")[0];if(t)return t.substring(6)},n.parseFingerprint=function(r){const t=r.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},n.getDtlsParameters=function(r,t){return{role:"auto",fingerprints:n.matchPrefix(r+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(r,t){let i="a=setup:"+t+`\r
`;return r.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},n.parseCryptoLine=function(r){const t=r.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},n.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?n.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},n.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const t=r.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},n.getCryptoParameters=function(r,t){return n.matchPrefix(r+t,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(r,t){const i=n.matchPrefix(r+t,"a=ice-ufrag:")[0],s=n.matchPrefix(r+t,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},n.writeIceParameters=function(r){let t="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(t+=`a=ice-lite\r
`),t},n.parseRtpParameters=function(r){const t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=n.splitLines(r)[0].split(" ");t.profile=s[2];for(let o=3;o<s.length;o++){const u=s[o],c=n.matchPrefix(r,"a=rtpmap:"+u+" ")[0];if(c){const p=n.parseRtpMap(c),f=n.matchPrefix(r,"a=fmtp:"+u+" ");switch(p.parameters=f.length?n.parseFmtp(f[0]):{},p.rtcpFeedback=n.matchPrefix(r,"a=rtcp-fb:"+u+" ").map(n.parseRtcpFb),t.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(p.name.toUpperCase());break}}}n.matchPrefix(r,"a=extmap:").forEach(o=>{t.headerExtensions.push(n.parseExtmap(o))});const a=n.matchPrefix(r,"a=rtcp-fb:* ").map(n.parseRtcpFb);return t.codecs.forEach(o=>{a.forEach(u=>{o.rtcpFeedback.find(p=>p.type===u.type&&p.parameter===u.parameter)||o.rtcpFeedback.push(u)})}),t},n.writeRtpDescription=function(r,t){let i="";i+="m="+r+" ",i+=t.codecs.length>0?"9":"0",i+=" "+(t.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=t.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,t.codecs.forEach(a=>{i+=n.writeRtpMap(a),i+=n.writeFmtp(a),i+=n.writeRtcpFb(a)});let s=0;return t.codecs.forEach(a=>{a.maxptime>s&&(s=a.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),t.headerExtensions&&t.headerExtensions.forEach(a=>{i+=n.writeExtmap(a)}),i},n.parseRtpEncodingParameters=function(r){const t=[],i=n.parseRtpParameters(r),s=i.fecMechanisms.indexOf("RED")!==-1,a=i.fecMechanisms.indexOf("ULPFEC")!==-1,o=n.matchPrefix(r,"a=ssrc:").map(l=>n.parseSsrcMedia(l)).filter(l=>l.attribute==="cname"),u=o.length>0&&o[0].ssrc;let c;const p=n.matchPrefix(r,"a=ssrc-group:FID").map(l=>l.substring(17).split(" ").map(g=>parseInt(g,10)));p.length>0&&p[0].length>1&&p[0][0]===u&&(c=p[0][1]),i.codecs.forEach(l=>{if(l.name.toUpperCase()==="RTX"&&l.parameters.apt){let d={ssrc:u,codecPayloadType:parseInt(l.parameters.apt,10)};u&&c&&(d.rtx={ssrc:c}),t.push(d),s&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:u,mechanism:a?"red+ulpfec":"red"},t.push(d))}}),t.length===0&&u&&t.push({ssrc:u});let f=n.matchPrefix(r,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-50*40*8:f=void 0,t.forEach(l=>{l.maxBitrate=f})),t},n.parseRtcpParameters=function(r){const t={},i=n.matchPrefix(r,"a=ssrc:").map(o=>n.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];i&&(t.cname=i.value,t.ssrc=i.ssrc);const s=n.matchPrefix(r,"a=rtcp-rsize");t.reducedSize=s.length>0,t.compound=s.length===0;const a=n.matchPrefix(r,"a=rtcp-mux");return t.mux=a.length>0,t},n.writeRtcpParameters=function(r){let t="";return r.reducedSize&&(t+=`a=rtcp-rsize\r
`),r.mux&&(t+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(t+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),t},n.parseMsid=function(r){let t;const i=n.matchPrefix(r,"a=msid:");if(i.length===1)return t=i[0].substring(7).split(" "),{stream:t[0],track:t[1]};const s=n.matchPrefix(r,"a=ssrc:").map(a=>n.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(s.length>0)return t=s[0].value.split(" "),{stream:t[0],track:t[1]}},n.parseSctpDescription=function(r){const t=n.parseMLine(r),i=n.matchPrefix(r,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const a=n.matchPrefix(r,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:t.fmt,maxMessageSize:s};const o=n.matchPrefix(r,"a=sctpmap:");if(o.length>0){const u=o[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:s}}},n.writeSctpDescription=function(r,t){let i=[];return r.protocol!=="DTLS/SCTP"?i=["m="+r.kind+" 9 "+r.protocol+" "+t.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+t.port+`\r
`]:i=["m="+r.kind+" 9 "+r.protocol+" "+t.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+t.port+" "+t.protocol+` 65535\r
`],t.maxMessageSize!==void 0&&i.push("a=max-message-size:"+t.maxMessageSize+`\r
`),i.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(r,t,i){let s;const a=t!==void 0?t:2;return r?s=r:s=n.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.getDirection=function(r,t){const i=n.splitLines(r);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(r){return n.splitLines(r)[0].split(" ")[0].substring(2)},n.isRejected=function(r){return r.split(" ",2)[1]==="0"},n.parseMLine=function(r){const i=n.splitLines(r)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},n.parseOLine=function(r){const i=n.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},n.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const t=n.splitLines(r);for(let i=0;i<t.length;i++)if(t[i].length<2||t[i].charAt(1)!=="=")return!1;return!0},e.exports=n})(Fe);var Ue=Fe.exports;const k=qe(Ue),ot=et({__proto__:null,default:k},[Ue]);function O(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const n=e.RTCIceCandidate;e.RTCIceCandidate=function(t){if(typeof t=="object"&&t.candidate&&t.candidate.indexOf("a=")===0&&(t=JSON.parse(JSON.stringify(t)),t.candidate=t.candidate.substring(2)),t.candidate&&t.candidate.length){const i=new n(t),s=k.parseCandidate(t.candidate);for(const a in s)a in i||Object.defineProperty(i,a,{value:s[a]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new n(t)},e.RTCIceCandidate.prototype=n.prototype,P(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function G(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||P(e,"icecandidate",n=>{if(n.candidate){const r=k.parseCandidate(n.candidate.candidate);r.type==="relay"&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return n})}function I(e,n){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp=="undefined"?null:this._sctp}});const r=function(o){if(!o||!o.sdp)return!1;const u=k.splitSections(o.sdp);return u.shift(),u.some(c=>{const p=k.parseMLine(c);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},t=function(o){const u=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const c=parseInt(u[1],10);return c!==c?-1:c},i=function(o){let u=65536;return n.browser==="firefox"&&(n.version<57?o===-1?u=16384:u=2147483637:n.version<60?u=n.version===57?65535:65536:u=2147483637),u},s=function(o,u){let c=65536;n.browser==="firefox"&&n.version===57&&(c=65535);const p=k.matchPrefix(o.sdp,"a=max-message-size:");return p.length>0?c=parseInt(p[0].substring(19),10):n.browser==="firefox"&&u!==-1&&(c=2147483637),c},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,n.browser==="chrome"&&n.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp=="undefined"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const u=t(arguments[0]),c=i(u),p=s(arguments[0],u);let f;c===0&&p===0?f=Number.POSITIVE_INFINITY:c===0||p===0?f=Math.max(c,p):f=Math.min(c,p);const l={};Object.defineProperty(l,"maxMessageSize",{get(){return f}}),this._sctp=l}return a.apply(this,arguments)}}function L(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function n(t,i){const s=t.send;t.send=function(){const o=arguments[0],u=o.length||o.size||o.byteLength;if(t.readyState==="open"&&i.sctp&&u>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(t,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=r.apply(this,arguments);return n(i,this),i},P(e,"datachannel",t=>(n(t.channel,t.target),t))}function V(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const t=n[r];n[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",i);s.dispatchEvent(a)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}})}function J(e,n){if(!e.RTCPeerConnection||n.browser==="chrome"&&n.version>=71||n.browser==="safari"&&n.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return r.apply(this,arguments)}}function j(e,n){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const r=e.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(n.browser==="chrome"&&n.version<78||n.browser==="firefox"&&n.version<68||n.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function A(e,n){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const r=e.RTCPeerConnection.prototype.setLocalDescription;!r||r.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return r.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?r.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>r.apply(this,[a]))})}const at=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:J,shimAddIceCandidateNullOrEmpty:j,shimConnectionState:V,shimMaxMessageSize:I,shimParameterlessSetLocalDescription:A,shimRTCIceCandidate:O,shimRTCIceCandidateRelayProtocol:G,shimSendThrowTypeError:L},Symbol.toStringTag,{value:"Module"}));function ct({window:e}={},n={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=oe,t=nt(e),i={browserDetails:t,commonShim:at,extractVersion:M,disableLog:tt,disableWarnings:rt,sdp:ot};switch(t.browser){case"chrome":if(!ee||!N||!n.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(t.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=ee,j(e,t),A(e),ce(e,t),pe(e),N(e,t),ue(e),he(e,t),fe(e),le(e),de(e),ge(e,t),O(e),G(e),V(e),I(e,t),L(e),J(e,t);break;case"firefox":if(!te||!z||!n.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=te,j(e,t),A(e),Ce(e,t),z(e,t),ye(e),Te(e),ve(e),Se(e),Re(e),Pe(e),be(e),_e(e),ke(e),O(e),V(e),I(e,t),L(e);break;case"safari":if(!re||!n.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=re,j(e,t),A(e),Ie(e),je(e),xe(e),Ee(e),De(e),Le(e),Me(e),Ae(e),O(e),G(e),I(e,t),L(e),J(e,t);break;default:r("Unsupported browser!");break}return i}ct({window:typeof window=="undefined"?void 0:window});function pt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ze(e)}const B=Ke("webrtc"),ut=B.b(),ft=B.e("local video-frame"),lt=B.e("remote video-frame"),ne="answer";var S=function(e){return e.disconnected="disconnected",e.connecting="connecting",e.connected="connected",e.disconnectedByUser="disconnectedByUser",e}(S||{});const Ct=Qe({name:"WebRTCPage",setup(){const n=!!We().query[ne];n||D.info("请根据页面提示打开另一个tab页面！");const r=R(""),t=R(""),i=n?[{title:"复制远端端SDP",description:"请将远端生成的SDP粘贴到下方"},{title:"生成本地SDP",description:"请点击生成本地SDP "}]:[{title:"创建本地SDP",description:"并将本地生成的SDP复制到另一个tab页 "},{title:"填写远端SDP",description:"请粘贴来自远端端生成的SDP"}],s=R(0),a=R(null),o=R(null);let u=null,c=null;const p=R(S.disconnected),f=R(!1);function l(){return T(this,null,function*(){try{if(p.value!==S.disconnected)return d();p.value=S.connecting,c=new RTCPeerConnection,u=yield Ge(),yield g()}catch(h){console.log(h),d()}})}function d(){u&&u.getTracks().forEach(h=>{h.stop()}),p.value=S.disconnected,c==null||c.close(),s.value=0}function g(){return T(this,null,function*(){yield we();const h=a.value;h&&(h.srcObject=u,yield C())})}function C(){return T(this,null,function*(){u==null||u.getTracks().forEach(h=>{c.addTrack(h,u)}),c.ontrack=h=>{console.log("ontrack",h),o.value.srcObject=h.streams[0]},c==null||c.addEventListener("iceconnectionstatechange",()=>{switch(c==null?void 0:c.iceConnectionState){case"checking":console.log("checking...");break;case"connected":case"completed":f.value=!0,p.value=S.connected,console.log("connected...");break;case"disconnected":console.log("disconnected..."),f.value=!1,p.value=S.disconnected,c==null||c.close(),d();break;default:console.log("default")}})})}function Ne(){return T(this,null,function*(){const h=yield c.createOffer();yield c.setLocalDescription(h),c.onicecandidate=v=>{v.candidate&&(r.value||Ye.success({message:"本端SDP生成成功",description:()=>m(_,{onClick:()=>{K(JSON.stringify(c==null?void 0:c.localDescription)),D.success("复制成功")}},{default:()=>[y("点我复制")]}),duration:0}),r.value=JSON.stringify(c==null?void 0:c.localDescription))}})}function ze(){return T(this,null,function*(){u||(yield l()),yield c==null?void 0:c.setRemoteDescription(JSON.parse(t.value));const h=yield c.createAnswer();yield c.setLocalDescription(h),r.value=JSON.stringify(c==null?void 0:c.localDescription)})}function Ge(h){return T(this,null,function*(){try{return n?yield navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}):yield navigator.mediaDevices.getUserMedia(X({audio:!0,video:{width:1920,height:1080}},h))}catch(v){throw(v==null?void 0:v.message)==="Requested device not found"&&D.error("没有可用的摄像头设备!"),v}})}function E(){return T(this,null,function*(){n?s.value===0?(yield ze(),D.success("创建成功")):(K(r.value),D.success("复制成功")):(u||(yield l()),s.value===0?yield Ne():s.value===1?c.currentRemoteDescription||c.setRemoteDescription(JSON.parse(t.value)):(c==null||c.close(),d())),s.value++})}function K(h){navigator.clipboard.writeText(h)}return()=>{const h=s.value,v=n?h===0?m(x,null,{default:()=>[m(Y,{value:t.value,"onUpdate:value":b=>t.value=b,placeholder:"请输入远端生成的SDP"},null),m(_,{type:"primary",disabled:!t.value,onClick:E},{default:()=>[y("点击生成本机SDP")]})]}):m(x,null,{default:()=>[m(_,{type:"primary",onClick:E},{default:()=>[y("复制本地SDP到远端")]})]}):h===0?m(_,{type:"primary",onClick:E},{default:()=>[y("点击生成本地SDP")]}):h===1?m(x,null,{default:()=>[m(Y,{value:t.value,"onUpdate:value":b=>t.value=b,placeholder:"请输入远端生成的SDP",class:"w-200"},null),m(_,{type:"primary",disabled:!t.value,onClick:E},{default:()=>[y("点击连接")]})]}):m(_,{type:"primary",danger:!0,onClick:E},{default:()=>[y("断开连接")]});return m(Be,{title:m(F,null,[y("本地模拟WebRTC通话"),n?"":m(F,null,[y("（"),m("a",{href:"/#/base-webrtc?"+ne+"=true",target:"_blank"},[y("请点击打开第二个tab页")]),y("）")])])},{default:()=>[m(He,null,{default:()=>[m(Q,{span:16},{default:()=>[m(Xe,{current:s.value,size:"small",items:i,direction:"vertical"},null)]}),m(Q,{span:8},{default:()=>{var b;return[m("h2",{style:"color: salmon"},[(b=i[s.value])==null?void 0:b.title])]}})]}),m(x,null,pt(v)?v:{default:()=>[v]}),p.value!==S.disconnected&&m(F,null,[m("br",null,null),m("br",null,null),m("div",{class:ut},[m("video",{ref:a,autoplay:!0,muted:!0,class:`${ft} ${p.value===S.connected?"":"large"}`},null),m("video",{ref:o,autoplay:!0,class:`${lt} ${p.value===S.connected?"large":""}`},null)]),m("footer",null,[y("sdf")])])]})}}});export{Ct as default};
