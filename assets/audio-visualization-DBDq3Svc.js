var D=(o,e,i)=>new Promise((u,g)=>{var h=l=>{try{a(i.next(l))}catch(s){g(s)}},m=l=>{try{a(i.throw(l))}catch(s){g(s)}},a=l=>l.done?u(l.value):Promise.resolve(l.value).then(h,m);a((i=i.apply(o,e)).next())});import{T as j,D as G,I as H}from"./index.Dmkzir.js";import{m as U,h as X,s as Y,P as J,u as K,v as Q,D as B}from"./antd-BcJUCkMQ.js";import{d as Z,f as S,b as _,k as c,E as $}from"./vue-BMZVVpNU.js";const M=["https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/wujiapo2021.mp3","https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/puremusic.mp3"],le=Z({name:"AudioVisualizationPage",setup(){let o=0;const e=new Audio(M[o]),i=S(!1),u=S(),g=S();let h,m,a,l,s,I,x,T,d,f,z,v,A,C,w;e.crossOrigin="anonymous",O();function F(t){t==="play"?(i.value?(e.pause(),C&&cancelAnimationFrame(C),w&&cancelAnimationFrame(w)):(e.play(),L()),i.value=!i.value):t==="prev"?(o===0?o=M.length-1:o--,e.src=M[o],i.value&&e.play()):(o===M.length-1?o=0:o++,e.src=M[o],i.value&&e.play())}function O(){let t=e.play.bind(e);e.play=function(){return D(this,null,function*(){return new Promise((r,n)=>D(this,null,function*(){t().then(r).catch(R=>{setTimeout(()=>{i.value=!1},500),n(R),U.error("播放出错了,可能资源不能使用了...")})}))})},e.onended=()=>F("next")}function L(){x=u.value.width=u.value.parentElement.offsetWidth-48,T=u.value.height=120,A=u.value.getContext("2d"),A.fillStyle="#4646fc";const t=g.value;h=t.width,m=t.height,a=t.getContext("2d"),a.fillStyle="#4646fc",l=h/2,s=m/2,I=Math.min(h,m)/6,e.play(),v||(v=new AudioContext,z=v.createMediaElementSource(e),d=v.createAnalyser(),d.fftSize=512,z.connect(d),d.connect(v.destination),f=new Uint8Array(d.frequencyBinCount)),E(),q()}function E(){A.clearRect(0,0,x,T),d.getByteFrequencyData(f);const t=f.length/2,r=x/t/2;for(let n=0;n<t;n++){const p=f[n]/255*T,y=n*r+x/2,b=x/2-(n+1)*r,P=T-p;A.fillRect(y,P,r,p),A.fillRect(b,P,r,p)}C=requestAnimationFrame(E)}function q(){a.clearRect(0,0,h,m);const t=140;a.arc(l,s,I,0,2*Math.PI),a.fill(),a.beginPath(),d.getByteFrequencyData(f);const r=Math.floor((f.length-50)/t);a.moveTo(l,s);for(let n=0;n<t;n++){const p=f[n*r]/255*100+I,y=-n*(2*Math.PI/t),b=l+p*Math.cos(y),P=s+p*Math.sin(y);if(a.lineTo(b,P),n<t){let k=-(n+1)*(2*Math.PI/t);k=y+(k-y)/2;const V=l+50*Math.cos(k),W=s+50*Math.sin(k);a.quadraticCurveTo(b,P,V,W)}}a.closePath(),a.fill(),w=requestAnimationFrame(q)}function N(){e==null||e.pause(),C&&cancelAnimationFrame(C),w&&cancelAnimationFrame(w)}return _(N),()=>c(H,{style:"width:100%;max-width: 700px;margin: 12px auto"},{default:()=>[c(X,null,{default:()=>[c(Y,{style:"font-size:28px",onClick:()=>F("prev")},null),c(j,{direction:G.LEFT},{default:()=>[i.value?c(J,{style:"font-size:22px",onClick:()=>F("play")},null):c(K,{style:"font-size:28px",onClick:()=>F("play")},null)]}),c(Q,{style:"font-size:28px",onClick:()=>F("next")},null),c("strong",null,[$("播放音频")])]}),c(B,null,null),c("canvas",{ref:u,style:"max-width:100%",height:0},null),c(B,null,null),c("canvas",{ref:g,width:400,height:400,style:"display:block;max-width:100%;margin:0 auto"},null)]})}});export{le as default};
