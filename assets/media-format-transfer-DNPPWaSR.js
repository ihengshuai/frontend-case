var H=Object.defineProperty;var j=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var Z=(t,e,u)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):t[e]=u;var x=(t,e)=>{var u={};for(var a in t)J.call(t,a)&&e.indexOf(a)<0&&(u[a]=t[a]);if(t!=null&&j)for(var a of j(t))e.indexOf(a)<0&&Y.call(t,a)&&(u[a]=t[a]);return u};var c=(t,e,u)=>(Z(t,typeof e!="symbol"?e+"":e,u),u),G=(t,e,u)=>{if(!e.has(t))throw TypeError("Cannot "+u)};var r=(t,e,u)=>(G(t,e,"read from private field"),u?u.call(t):e.get(t)),C=(t,e,u)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,u)},L=(t,e,u,a)=>(G(t,e,"write to private field"),a?a.call(t,u):e.set(t,u),u);var B=(t,e,u)=>new Promise((a,o)=>{var i=E=>{try{p(u.next(E))}catch(m){o(m)}},h=E=>{try{p(u.throw(E))}catch(m){o(m)}},p=E=>E.done?a(E.value):Promise.resolve(E.value).then(i,h);p((u=u.apply(t,e)).next())});import{I as q}from"./index.Dmkzir.js";import{j as K,R as M,k as S,l as Q,B as ee,D as ue,m as W,n as te}from"./antd-BcJUCkMQ.js";import{d as ae,f as y,c as U,w as re,k as s,E as d}from"./vue-BMZVVpNU.js";var l;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(l||(l={}));const oe=(()=>{let t=0;return()=>t++})(),ne=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),le=new Error("called FFmpeg.terminate()");var F,w,R,v,b,g,f;class se{constructor(){C(this,F,null);C(this,w,{});C(this,R,{});C(this,v,[]);C(this,b,[]);c(this,"loaded",!1);C(this,g,()=>{r(this,F)&&(r(this,F).onmessage=({data:{id:e,type:u,data:a}})=>{switch(u){case l.LOAD:this.loaded=!0,r(this,w)[e](a);break;case l.MOUNT:case l.UNMOUNT:case l.EXEC:case l.WRITE_FILE:case l.READ_FILE:case l.DELETE_FILE:case l.RENAME:case l.CREATE_DIR:case l.LIST_DIR:case l.DELETE_DIR:r(this,w)[e](a);break;case l.LOG:r(this,v).forEach(o=>o(a));break;case l.PROGRESS:r(this,b).forEach(o=>o(a));break;case l.ERROR:r(this,R)[e](a);break}delete r(this,w)[e],delete r(this,R)[e]})});C(this,f,({type:e,data:u},a=[],o)=>r(this,F)?new Promise((i,h)=>{const p=oe();r(this,F)&&r(this,F).postMessage({id:p,type:e,data:u},a),r(this,w)[p]=i,r(this,R)[p]=h,o==null||o.addEventListener("abort",()=>{h(new DOMException(`Message # ${p} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(ne));c(this,"load",(o={},{signal:a}={})=>{var i=o,{classWorkerURL:e}=i,u=x(i,["classWorkerURL"]);return r(this,F)||(L(this,F,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-Bmmp-DmP.js",import.meta.url),{type:"module"})),r(this,g).call(this)),r(this,f).call(this,{type:l.LOAD,data:u},void 0,a)});c(this,"exec",(e,u=-1,{signal:a}={})=>r(this,f).call(this,{type:l.EXEC,data:{args:e,timeout:u}},void 0,a));c(this,"terminate",()=>{const e=Object.keys(r(this,R));for(const u of e)r(this,R)[u](le),delete r(this,R)[u],delete r(this,w)[u];r(this,F)&&(r(this,F).terminate(),L(this,F,null),this.loaded=!1)});c(this,"writeFile",(e,u,{signal:a}={})=>{const o=[];return u instanceof Uint8Array&&o.push(u.buffer),r(this,f).call(this,{type:l.WRITE_FILE,data:{path:e,data:u}},o,a)});c(this,"mount",(e,u,a)=>{const o=[];return r(this,f).call(this,{type:l.MOUNT,data:{fsType:e,options:u,mountPoint:a}},o)});c(this,"unmount",e=>{const u=[];return r(this,f).call(this,{type:l.UNMOUNT,data:{mountPoint:e}},u)});c(this,"readFile",(e,u="binary",{signal:a}={})=>r(this,f).call(this,{type:l.READ_FILE,data:{path:e,encoding:u}},void 0,a));c(this,"deleteFile",(e,{signal:u}={})=>r(this,f).call(this,{type:l.DELETE_FILE,data:{path:e}},void 0,u));c(this,"rename",(e,u,{signal:a}={})=>r(this,f).call(this,{type:l.RENAME,data:{oldPath:e,newPath:u}},void 0,a));c(this,"createDir",(e,{signal:u}={})=>r(this,f).call(this,{type:l.CREATE_DIR,data:{path:e}},void 0,u));c(this,"listDir",(e,{signal:u}={})=>r(this,f).call(this,{type:l.LIST_DIR,data:{path:e}},void 0,u));c(this,"deleteDir",(e,{signal:u}={})=>r(this,f).call(this,{type:l.DELETE_DIR,data:{path:e}},void 0,u))}on(e,u){e==="log"?r(this,v).push(u):e==="progress"&&r(this,b).push(u)}off(e,u){e==="log"?L(this,v,r(this,v).filter(a=>a!==u)):e==="progress"&&L(this,b,r(this,b).filter(a=>a!==u))}}F=new WeakMap,w=new WeakMap,R=new WeakMap,v=new WeakMap,b=new WeakMap,g=new WeakMap,f=new WeakMap;const ie=new Error("failed to get response body reader"),Ee=new Error("failed to complete download"),de="Content-Length",ce=t=>new Promise((e,u)=>{const a=new FileReader;a.onload=()=>{const{result:o}=a;o instanceof ArrayBuffer?e(new Uint8Array(o)):e(new Uint8Array)},a.onerror=o=>{var i,h;u(Error(`File could not be read! Code=${((h=(i=o==null?void 0:o.target)==null?void 0:i.error)==null?void 0:h.code)||-1}`))},a.readAsArrayBuffer(t)}),fe=t=>B(void 0,null,function*(){let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(u=>u.charCodeAt(0)):e=yield(yield fetch(t)).arrayBuffer();else if(t instanceof URL)e=yield(yield fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=yield ce(t);else return new Uint8Array;return new Uint8Array(e)}),pe=(t,e)=>B(void 0,null,function*(){var o;const u=yield fetch(t);let a;try{const i=parseInt(u.headers.get(de)||"-1"),h=(o=u.body)==null?void 0:o.getReader();if(!h)throw ie;const p=[];let E=0;for(;;){const{done:n,value:D}=yield h.read(),A=D?D.length:0;if(n){if(i!=-1&&i!==E)throw Ee;e&&e({url:t,total:i,received:E,delta:A,done:n});break}p.push(D),E+=A,e&&e({url:t,total:i,received:E,delta:A,done:n})}const m=new Uint8Array(E);let O=0;for(const n of p)m.set(n,O),O+=n.length;a=m.buffer}catch(i){console.log("failed to send download progress event: ",i),a=yield u.arrayBuffer(),e&&e({url:t,total:a.byteLength,received:a.byteLength,delta:0,done:!0})}return a}),_=(t,e,u=!1,a)=>B(void 0,null,function*(){const o=u?yield pe(t,a):yield(yield fetch(t)).arrayBuffer(),i=new Blob([o],{type:e});return URL.createObjectURL(i)}),T="https://unpkg.com/@ffmpeg/core-mt@0.12.6/dist/esm",N=[{type:"video/mp4",label:"MP4"},{type:"video/webm",label:"WEBM"},{type:"video/ogg",label:"OGG"},{type:"video/avi",label:"AVI"},{type:"video/mov",label:"MOV"},{type:"video/flv",label:"FLV"},{type:"video/wmv",label:"WMV"},{type:"video/3gp",label:"3GP"},{type:"video/3g2",label:"3G2"}],k=[{type:"audio/mp3",label:"MP3"},{type:"audio/wav",label:"WAV"},{type:"audio/ogg",label:"OGG"},{type:"audio/wma",label:"WMA"}];let $=!1;const Fe=/\.([^\.]+)$/,Ce=ae({name:"MediaFormatTransferPage",setup(){const t=y("video"),e=new se,u=y(),a=y("mp4"),o=y(!1),i=y(0),h=U(()=>t.value==="video"?N.map(n=>n.label).join(", "):k.map(n=>n.label).join(", ")),p=U(()=>t.value==="video"?N.map(n=>n.type).join(","):k.map(n=>n.type).join(",")),E=U(()=>t.value==="video"?N.map(n=>({label:n.label,value:n.type.replace("video/","")})):k.map(n=>({label:n.label,value:n.type.replace("audio/","")})));re(t,()=>{a.value=t.value==="video"?"mp4":"mp3",u.value=null});const m=n=>B(this,null,function*(){return u.value=n,!1}),O=()=>B(this,null,function*(){var n;if(u.value==null){W.warn("请选择转换的资源文件!");return}try{$||(yield e.load({coreURL:yield _(`${T}/ffmpeg-core.js`,"text/javascript"),wasmURL:yield _(`${T}/ffmpeg-core.wasm`,"application/wasm"),workerURL:yield _(`${T}/ffmpeg-core.worker.js`,"text/javascript")})),$=!0,e.on("progress",z=>{i.value=z.progress*100>>0});const D=(n=u.value.name.match(Fe))==null?void 0:n[1],A=a.value;if(!D)return;o.value=!0,yield e.writeFile(`input.${D}`,yield fe(u.value)),yield e.exec(["-i",`input.${D}`,`output.${A}`]);const V=yield e.readFile(`output.${A}`),X=new Blob([V.buffer]),P=URL.createObjectURL(X),I=document.createElement("a");I.href=P,I.download=`${+new Date}__(case.usword.cn).${A}`,I.click(),te.success({message:"转换成功",description:"文件格式转换成功,请下载后查看。"}),setTimeout(()=>{URL.revokeObjectURL(P)},5e3)}catch(D){W.error("转换失败!"),console.log(D)}finally{return o.value=!1,i.value=0,!1}});return()=>s(q,{style:"max-width: 900px;margin: 12px auto"},{default:()=>[s(K,{type:"warning",showIcon:!0,message:"由于一些脚本请求需要额外的请求头，本站为静态网站没法提供，如需使用还请拉取代码本地跑起来即可"},null),s("h1",{style:"font-size: 30px;text-align: center"},[d("媒体资源格式转换")]),d("转换："),s(M,{value:t.value,"onUpdate:value":n=>t.value=n,"button-style":"solid"},{default:()=>[s(S,{value:"video"},{default:()=>[d("视频")]}),s(S,{value:"audio"},{default:()=>[d("音频")]})]}),s("br",null,null),s("br",null,null),s("h2",null,[d("1. 选择资源")]),s(Q,{showUploadList:!1,beforeUpload:m,accept:p.value},{default:()=>[s("h3",null,[d("点击或将"),t.value==="video"?"视频":"音频",d("资源拖入此区域")]),s("p",null,[d("支持 "),h.value,d(" 格式")]),s("p",{style:{color:"var(--color-border)"}},[(u==null?void 0:u.value)&&"当前文件："+u.value.name])]}),s("br",null,null),s("h2",null,[d("2. 选择输出参数")]),s(M,{value:a.value,"onUpdate:value":n=>a.value=n,options:E.value},null),s("br",null,null),s("br",null,null),s("h2",null,[d("3. 开始转换")]),s(ee,{loading:o.value,type:"primary",onClick:O},{default:()=>[o.value?`转换中... (${i.value}%)`:"开始转换"]}),s("br",null,null),s(ue,null,null),s("p",null,[d("使用本工具转换，剪切视频文件共有三个步骤。")]),s("p",null,[d("第一步，选择视频文件，请查看支持的文件格式，未知的格式可能会转换失败。你可以点击按钮选择文件，或者把文件拖入。")]),s("p",null,[d("第二步，设置输出文件的格式，每一种格式有各自的编码器和参数。如果你不熟悉参数的意思，可以按照默认的设置。如果你是这方面的专家，可以选择高级模式。")]),s("p",null,[d("第三步，点击转换按钮，等待转换完成。第一次使用会比较慢，因为需要加载JS代码。转换完成后，点击保存到电脑。")])]})}});export{Ce as default};
